{% extends "base.html" %}
{% block title %}Configuraci√≥n - La Posta{% endblock %}

{% block content %}
<h2>Configuraci√≥n</h2>
<hr />

<div class="row">
  <!-- üîê Cambiar contrase√±a del admin actual -->
  <div class="col-md-6">
    <div class="card mb-4 shadow-sm p-3">
      <h4>Cambiar contrase√±a</h4>
      <p class="text-muted small">
        Admin actual:
        {% if admin_actual %}
          <strong>{{ admin_actual.usuario }}</strong>
        {% else %}
          <span class="text-danger">No se detect√≥ el admin actual en sesi√≥n.</span>
        {% endif %}
      </p>

      <form method="POST" action="{{ url_for('configuracion') }}">
        <input type="hidden" name="accion" value="cambiar_password" />

        <div class="mb-3">
          <label for="password_nueva" class="form-label">Nueva contrase√±a</label>
          <input
            type="password"
            id="password_nueva"
            name="password_nueva"
            class="form-control"
            required
          />
        </div>

        <button type="submit" class="btn btn-primary">
          Guardar nueva contrase√±a
        </button>
      </form>
    </div>
  </div>

  <!-- üßë‚Äçüíª Administraci√≥n de usuarios admin -->
  <div class="col-md-6">
    <div class="card mb-4 shadow-sm p-3">
      <h4>Administrar administradores</h4>

      <!-- Lista de admins -->
      <h6 class="mt-2">Admins registrados</h6>
      <table class="table table-sm table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Creado</th>
          </tr>
        </thead>
        <tbody>
          {% for admin in admins %}
          <tr>
            <td>{{ admin.id }}</td>
            <td>{{ admin.usuario }}</td>
            <td>
              {% if admin.creado_at %}
                {{ admin.creado_at.strftime("%Y-%m-%d") }}
              {% else %}
                -
              {% endif %}
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="3" class="text-center text-muted">
              No hay administradores registrados a√∫n.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Formulario para agregar nuevo admin -->
      <h6 class="mt-3">Agregar nuevo admin</h6>
      <form method="POST" action="{{ url_for('configuracion') }}">
        <input type="hidden" name="accion" value="nuevo_admin" />

        <div class="mb-2">
          <label for="usuario_nuevo" class="form-label">Usuario</label>
          <input
            type="text"
            id="usuario_nuevo"
            name="usuario_nuevo"
            class="form-control"
            placeholder="Ej. admin2"
            required
          />
        </div>

        <div class="mb-2">
          <label for="password_nuevo" class="form-label">Contrase√±a</label>
          <input
            type="password"
            id="password_nuevo"
            name="password_nuevo"
            class="form-control"
            required
          />
        </div>

        <button type="submit" class="btn btn-success">
          Crear administrador
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
